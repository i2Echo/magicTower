

// RPG剧本
var script = {
  hero: {
    name: "勇士",
    img: "hero",
    property:{
      HP: 10000,
      ATK: 110,
      DEF: 110,
      gold: 0
    },
    pack:{
      yellowKey: 0,
      blueKey: 0,
      redKey: 0
    },
    position: {
      atFloor: 'floor01',
      x: 5,
      y: 10
    }
  },
  floor00: {
    domain: 1,
    map: [
      [5, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0],
      [0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0],
      [0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0],
      [1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
      [0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0],
      [0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1],
      [1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0],
      [0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0],
      [0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1],
      [1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0],
      [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0]
    ],
    jump: [
      {name: "up", at: {x: 0, y: 0}, to: "floor01", targetAt: {x: 5, y: 10}}
    ]
  },
  floor01: {
    domain: 1,
    map: [
      [5, 0, 101, 102, 101, 0, 0, 0, 0, 0, 0],
      [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
      [25, 0, 0, 10, 0, 1, 27, 21, 0, 1, 0],
      [0, 105, 0, 1, 0, 1, 28, 25, 0, 1, 0],
      [1, 10, 1, 1, 0, 1, 1, 1, 10, 1, 0],
      [21, 0, 0, 1, 0, 10, 103, 104, 103, 1, 0],
      [0, 106, 0, 1, 0, 1, 1, 1, 1, 1, 0],
      [1, 10, 1, 1, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 1, 1, 10, 1, 1, 1, 10, 1],
      [25, 0, 21, 1, 21, 0, 0, 1, 0, 103, 0],
      [25, 41, 21, 1, 0, 0, 0, 1, 101, 26, 101]
    ],
    jump: [
      {name: "up", at: {x: 0, y: 0}, to: "floor02", targetAt: {x: 0, y: 1}}
    ]
  },
  floor02: {
    domain: 1,
    map: [
      [6, 0, 11, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 1, 1, 0, 121, 0, 121, 0, 1, 1],
      [0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1],
      [0, 1, 21, 21, 1, 0, 0, 0, 1, 0, 81],
      [0, 1, 21, 0, 14, 0, 0, 0, 14, 0, 0],
      [0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1],
      [0, 1, 83, 0, 1, 0, 0, 0, 1, 0, 82],
      [0, 1, 0, 0, 14, 0, 0, 0, 14, 0, 0],
      [0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1],
      [0, 1, 26, 26, 1, 0, 0, 0, 1, 0, 0],
      [5, 1, 26, 0, 14, 0, 0, 0, 14, 0, 0]
    ],
    jump: [
      {name: "up", at: {x: 0, y: 10}, to: "floor03", targetAt: {x: 1, y: 10}}
      ,{name: "down", at: {x: 0, y: 0}, to: "floor01", targetAt: {x: 1, y: 0}}
    ]
  },
  floor03: {
    domain: 1,
    map: [
      [21, 28, 1, 21, 26, 21, 1, 0, 1, 0, 25],
      [0, 25, 1, 26, 21, 26, 1, 0, 10, 103, 0],
      [104, 0, 1, 21, 22, 21, 1, 0, 1, 1, 1],
      [10, 1, 1, 1, 0, 1, 1, 0, 1, 0, 81],
      [0, 0, 103, 0, 0, 0, 101, 0, 0, 0, 0],
      [10, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1],
      [105, 0, 1, 1, 0, 1, 1, 0, 1, 0, 25],
      [0, 21, 1, 0, 0, 0, 1, 0, 10, 104,21],
      [25, 26, 1, 0, 0, 0, 1, 0, 1, 1, 1],
      [1, 1, 1, 1, 0, 1, 1, 102, 1, 0, 0],
      [6, 0, 0, 0, 0, 0, 1, 0, 10, 0, 5]
    ],
    jump: [
      {name: "up", at: {x: 10, y: 10}, to: "floor04", targetAt: {x: 10, y: 9}}
      ,{name: "down", at: {x: 0, y: 10}, to: "floor02", targetAt: {x: 0, y: 9}}
    ]
  },
  floor04: {
    domain: 1,
    map: [
      [0, 22, 0, 1, 7, 85, 8, 1, 0, 81, 0],
      [25, 0, 21, 1, 0, 0, 0, 1, 21, 0, 26],
      [0, 0, 0, 1, 0, 0, 0, 1, 0, 106, 0],
      [1, 10, 1, 1, 1, 11, 1, 1, 1, 10, 1],
      [0, 104, 0, 10, 0, 102, 0, 0, 105, 0, 0],
      [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
      [102, 0, 101, 0, 0, 0, 0, 0, 0, 0, 0],
      [10, 1, 1, 10, 1, 1, 1, 10, 1, 1, 10],
      [0, 1, 0, 103, 0, 1, 0, 104, 0, 1, 0],
      [0, 1, 101, 0, 21, 1, 27, 0, 25, 1, 0],
      [5, 1, 21, 101, 21, 1, 0, 101, 0, 1, 6]
    ],
    jump: [
      {name: "up", at: {x: 0, y: 10}, to: "floor05", targetAt: {x: 1, y: 10}}
      ,{name: "down", at: {x: 10, y: 10}, to: "floor03", targetAt: {x: 9, y: 10}}
    ]
  },
  floor05: {
    domain: 1,
    map: [
      [5, 1, 0, 102, 10, 0, 1, 0, 0, 10, 0],
      [0, 1, 0, 0, 1, 21, 1, 101, 101, 1, 102],
      [0, 10, 103, 0, 1, 0, 1, 21, 21, 1, 0],
      [1, 1, 1, 10, 1, 103, 1, 21, 21, 1, 0],
      [21, 0, 104, 0, 1, 0, 1, 1, 1, 1, 0],
      [21, 0, 0, 103, 1, 0, 101, 0, 0, 0, 0],
      [1, 106, 1, 1, 1, 0, 1, 1, 1, 1, 102],
      [0, 0, 0, 0, 1, 101, 1, 0, 0, 0, 0],
      [28, 21, 25, 40, 1, 0, 1, 10, 1, 1, 1],
      [1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0],
      [6, 0, 0, 0, 0, 0, 1, 0, 15, 0, 29]
    ],
    jump: [
      {name: "up", at: {x: 0, y: 0}, to: "floor06", targetAt: {x: 0, y: 1}}
      ,{name: "down", at: {x: 0, y: 10}, to: "floor04", targetAt: {x: 9, y: 10}}
    ]
  },
  floor06: {
    domain: 1,
    map: [
      [6, 1, 21, 21, 1, 0, 104, 0, 21, 101, 0],
      [0, 1, 21, 21, 1, 0, 1, 1, 1, 1, 10],
      [0, 1, 1, 102, 1, 0, 1, 25, 0, 105, 0],
      [0, 10, 10, 0, 10, 0, 1, 82, 0, 0, 103],
      [0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
      [0, 0, 102, 104, 0, 21, 0, 105, 106, 0, 0],
      [1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0],
      [104, 0, 0, 81, 1, 0, 10, 10, 0, 10, 0],
      [0, 103, 0, 28, 1, 0, 1, 1, 102, 1, 102],
      [10, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0],
      [0, 101, 0, 0, 106, 0, 1, 25, 25, 1, 5]
    ],
    jump: [
      {name: "up", at: {x: 0, y: 10}, to: "floor07", targetAt: {x: 1, y: 10}}
      ,{name: "down", at: {x: 10, y: 10}, to: "floor05", targetAt: {x: 0, y: 1}}
    ]
  },
};

/**
 * //根据脚本，初始化游戏画面
 * @param floor
 */
function scriptInit() {

  //地图层初始化
  mapLayer.removeAllChild();

  doorLayer.removeAllChild();
  itemLayer.removeAllChild();
  //人物层初始化
  npcLayer.removeAllChild();
  enemyLayer.removeAllChild();
  playerLayer.removeAllChild();
  //效果层初始化
  effectLayer.removeAllChild();
  //对话层初始化
  talkLayer.removeAllChild();

  // 获取楼层
  var floor = script.hero.position.atFloor
  //地图数据获取
  map = script[floor].map;

  //添加地图元素
  addElement();
  addHero();
}

/**
 * // 楼层跳转
 * @param current_floor
 */
function checkJump(){

  var position = hero.getPosition();
  var jump = script[position.atFloor].jump;

  for(var i=0;i<jump.length;i++){
    if(position.x == jump[i].at.x && position.y == jump[i].at.y){

      //设置跳转楼层的位置
      hero.setPosition(jump[i].to, jump[i].targetAt.x, jump[i].targetAt.y);
      //开始跳转
      scriptInit();
      return;
    }
  }
}